# Пульт охраны банка

Это внутренний репозиторий для сотрудников банка "Сияние". Если вы попали в этот репозиторий случайно, то вы не сможете его запустить, т. к. у вас нет доступа к БД, но можете свободно использовать код верстки или посмотреть как реализованы запросы к БД.

Пульт охраны - это сайт, который можно подключить к удаленной базе данных с визитами и карточками пропуска сотрудников нашего банка.

Программа подключается к базе данных, фиксирует все посещения хранилища и выводит данные на сайте, что помогает следить за всеми, кто находится в этом хранилище.


### Как установить

Часть настроек проекта берётся из переменных окружения. Чтобы их определить, создайте файл .env рядом с manage.py и запишите туда данные в формате: `ПЕРЕМЕННАЯ=значение`.

- DEBUG — дебаг-режим. Поставьте *True*, чтобы увидеть отладочную информацию в случае ошибки. Для prodaction сервера установите значение *False*;
- SECRET_KEY — секретный ключ проекта;
- DATABASES_HOST — хост базы данных;
- DATABASES_PORT — порт базы данных;
- DATABASES_NAME — имя базы данных;
- DATABASES_USER — имя пользователя базы данных;
- DATABASES_PASSWORD — пароль пользователя базы данных;
- ALLOWED_HOSTS — списое хостов, которые может обслуживать сайт, например: ALLOWED_HOSTS=.localhost,127.0.0.1,[::1]

Для запуска сервиса у вас уже должен быть установлен Python 3.
Установите зависимости с помощью `pip`:

```sh
pip install -r requirements.txt
```

### Как запустить

Для запуска введите команду:

```sh
python manage.py runserver 0.0.0.0:8000
```

После этого главная страница сайта будет доступна по адресу: http://127.0.0.1:8000.


## ORM

Модели описаны в папке `datacenter/models.py`.

Внутри модели Passcard описаны пропуска с полями:
* is_active - активна ли карта пропуска,
* created_at - дата выдачи пропуска,
* passcode - уникальный код пропуска,
* owner_name - имя и фамилия держателя пропуска.

Внутри модели Visit описаны посещения хранилища с полями:
* created_at - дата и время создания визита,
* passcard - пропуск для посещения,
* entered_at - дата и время входа в хранилище,
* leaved_at - дата и время выхода из хранилища.
  
Внутри модели Visit также описаны методы:

* **get_duration** - Метод рассчитывает длительность визита в секундах. Если работних до сих пор находится внутри хранилища, то время рассчитывается по настоящее время.
* **format_duration** - Метод превращает длительность визита в строку формата "hh:mm".
* **is_long** - Метод определяет, подозрителен визит или нет. Возвращает True или False.


## Страницы сайта

### /

Представление описано в 'datacenter/active_passcards_view.py'.

Страница показывает список активных пропусков.

---

### /storage_information

Представление описано в 'datacenter/storage_information_view.py'.

Страница показывает список сотрудников, находящихся внутри хранилища, а также их время проведенное внутри и индикатор подозрительности посещения.

---

### /passcard_info/<uuid:passcode>

Представление описано в 'datacenter/passcard_info_view.py'.

Страница показывает по конкретному пропуску сотрудника все его посещения в хранилище: время входа, проведенное внутри время и подозрительность пребывания.
В случае отсутствия пропуска, будет получена ошибка "404".

```python
passcard = get_object_or_404(Passcard, passcode=passcode)
```

---


### Цель проекта

Код написан в образовательных целях на онлайн-курсе для веб-разработчиков [dvmn.org](https://dvmn.org/).
